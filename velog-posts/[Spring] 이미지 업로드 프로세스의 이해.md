<p>이번에 프로젝트를 진행하면서 이미지 저장을 구현하게 되었다. </p>
<p>처음엔 이미지 저장? 그냥 경로 문자열로 왔다갔다 주고 받으면 되는 거 아냐? 하고 안일하게 생각했다... </p>
<p>그런데 생각하다보니 경로가 있으면 저장되는 곳이 있다는 거고, 그럼 그 저장되는 곳을 결국 클라이언트와 서버 둘 다 알아야 하는 건가...?라는 의문이 들어 공부해보게 되었다. </p>
<p>당장 이미지 저장 API 구현 방법에 대해 찾아보니 다들 <strong>이미지 스토리지</strong>라는 것을 사용하길래 그것에 대해서 더 찾아보았다. 역시 <strong>이미지 업로드 프로세스</strong>라는 것을 따로 정리해둔 글이 매우 많았다!</p>
<p>따라서 이번에는 여러 글들을 참고해서 이미지 업로드 프로세스를 처음 보는 사람도 이해하기 쉽도록 정리해볼 것이다.</p>
<h2 id="이미지-업로드-프로세스의-이해">이미지 업로드 프로세스의 이해</h2>
<h3 id="storage">Storage</h3>
<p>이미지 업로드 프로세스를 이해하려면, 먼저 스토리지(storage)를 사용하는 방법을 알아야 한다. 
스토리지? 처음 들어본 건 아니다. 대충 비휘발성 메모리라고 알고 있었다.
그러나 여기서 사용하는 스토리지는 다른 컴퓨터를 말한다! 이 스토리지는 <strong>클라우드</strong> 안에 존재한다고 한다. <del>클라우드는 다음에...</del></p>
<p>이미지 업로드의 어떤 상황에서 스토리지를 사용하냐? 
바로 받은 이미지를 저장할 때 사용한다. 이미지는 일반적인 데이터 타입과 확연히 차이나는 큰 용량을 가진다. 따라서 이를 DB에 직접 저장하는 것은 매우 비효율적이다. 그러므로 실제 이미지 파일은 스토리지에 저장하고, DB에는 스토리지에서의 해당 이미지 주소만을 저장한다. 
이미지를 조회하거나 사용하는 일이 생길 때, 스토리지의 해당 주소를 참조하여 이미지를 확인할 수 있다.</p>
<h3 id="이미지-업로드-프로세스">이미지 업로드 프로세스</h3>
<p>그림으로 간략히 표현한 이미지 업로드 프로세스이다. 
<img alt="" src="https://velog.velcdn.com/images/ahyeungii/post/9ae42ef6-c3f7-4b6e-975c-63630aa0935a/image.png" /></p>
<p>브라우저에서 사용자에게 받은 파일을 백엔드에게 보내주면 백엔드는 이 파일을 스토리지에 저장하고 스토리지로부터 주소를 받아온 뒤, 이 주소를 DB에 저장한다.</p>
<p>근데, 여기서 또 궁금한 점이 생길 것이다.</p>
<h3 id="클라이언트에서-서버로-파일을-어떻게-보내는가">클라이언트에서 서버로 파일을 어떻게 보내는가?</h3>
<h4 id="multipart라는-것을-이용한다">Multipart라는 것을 이용한다!</h4>
<p>멀티파트(Multipart)는 클라이언트-서버 간에 요청과 응답으로 여러 종류의 데이터를 동시에 전송할 때 사용하는 Content Type이다. </p>
<ul>
<li>일반적으로 파일 업로드에서 자주 사용된다.</li>
<li>HTTP 프로토콜은 일반적으로 텍스트 기반의 요청과 응답을 처리한다. 그렇기 때문에 파일과 같은 이진 데이터를 전송해야할 때 이를 텍스트 형식으로 인코딩하는 것은 비효율적이고 제한적이다. 멀티파트는 이러한 이진 데이터를 인코딩하지 않고 원본 형식으로 전송 가능하도록 해준다. </li>
<li>멀티파트 요청은 'Content-Type' 헤더에 multipart/form-data 값을 가지고, 여러 개의 파트로 구성된다. 각 파트는 개별적인 데이터 조각으로 파일이나 텍스트 데이터 등을 포함 가능하다. 각 파트는 헤더와 바디로 구성되어 있고, 헤더에는 파트의 메타데이터가 포함되어 있고 본문에는 실제 데이터가 포함된다.</li>
<li>멀티파트 요청을 처리하기 위해서는 서버 측에서 멀티파트 데이터를 파싱하고 해석하는 로직이 필요하다. 일반적으로 멀티파트 요청을 처리하는 라이브러리나 프레임워크를 사용하여 멀티파트 데이터를 추출하고 처리한다.</li>
<li><blockquote>
<p><strong>SpringMVC에서는 'MultipartResolver'를 사용하여 멀티파트 요청을 처리한다.</strong></p>
</blockquote>
</li>
</ul>